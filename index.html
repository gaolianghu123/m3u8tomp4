<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>M3U8 下载测试（零成本）</title>
</head>
<body>
<h2>M3U8 下载测试（零成本）</h2>

<p>输入 m3u8 URL（通过 Worker 代理解决跨域）</p>
<input type="text" id="m3u8url" value="https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8" style="width:400px;">
<button id="downloadBtn">生成下载链接</button>
<br><br>

<!-- 下载链接 -->
<a id="download" style="display:none;">下载视频</a>

<!-- 日志 -->
<pre id="log" style="width:400px;height:200px;overflow:auto;border:1px solid #ccc;"></pre>

<script>
const logEl = document.getElementById('log');
const downloadLink = document.getElementById('download');

document.getElementById('downloadBtn').addEventListener('click', async () => {
  const url = document.getElementById('m3u8url').value.trim();
  if (!url) return alert('请输入 m3u8 地址');

  logEl.textContent = '';
  downloadLink.style.display = 'none';

  try {
    logEl.textContent += '生成下载链接...\n';

    // 使用你的 Cloudflare Worker 代理
    const proxyUrl = 'https://m3u8tomp4worker.136401367.workers.dev/?url=' + encodeURIComponent(url);

    // 测试代理是否可访问
    const res = await fetch(proxyUrl, { method: 'HEAD' });
    if (!res.ok) throw new Error('代理无法访问视频');

    downloadLink.href = proxyUrl;
    downloadLink.download = 'video.m3u8';
    downloadLink.style.display = 'block';
    downloadLink.innerText = '点击下载视频';
    logEl.textContent += '下载链接生成成功！\n';

  } catch (err) {
    logEl.textContent += '生成失败: ' + err.message + '\n';
    console.error(err);
  }
});
</script>
</body>
</html>
